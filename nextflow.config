singularity.autoMounts = true
singularity.runOptions = '--no-mount=tmp'

manifest {
	name = 'NZ FOG'
	author = 'Guillermo A.R. Piccoli'
	homePage = 'https://www.epicsolutions.cl'
	description = 'Pipeline for NZ Flat Oyster Genetic Analises'
	version = '1.0.0'
}

executor{
    jobName = { "$task.tag" }
}

params {
    projectName = "fog"
	wdir = "/nfs/scratch/rodriggu"
    isoseq = "${params.wdir}/isoseq"
    outdir = "${params.wdir}/output"
	hifi = "${params.wdir}/hifi/F20FTSAPHT092_OYSobgD"
	hic = "${params.wdir}/hi-c/Filter_SOAPnuke/Clean/4W-MBD"
	refname = "4W-MBC"
	ref = "${params.hifi}/${params.refname}"
	bio = "docker://quay.io/biocontainers"
	FOG = "shub://kiwiepic/FOG"
}

profiles {
    standard {
		process.executor = 'slurm'
        process {
			withName: pbbam {
				container = "${params.bio}/pbbam:1.6.0--h5b7e6e0_0"
				memory = 1.GB
				cpus = 1
				time = '1h'
				queue = 'quicktest'
			}
			withName: bam2fastx {
				container = "${params.bio}/bam2fastx:1.3.0--he1c1bb9_8"
				memory = 10.GB
				cpus = 2
				time = '1h'
				queue = 'quicktest'
			}
			withName: fastqc {
        		container = "${params.bio}/fastqc:0.11.9--0"
				memory = 48.GB
				cpus = 12
				time = '1h'
				queue = 'parallel'
			}
			withName: multiqc {
				container = "${params.bio}/multiqc:1.9--py_1"
			}
			withName: canu {
                container = "${params.bio}/canu:2.1.1--he1b5a44_0"
                memory = 80.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
            }
			withName: peregrine {
				container = 'docker://cschin/peregrine:1.6.3'
				memory = 500.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
			}
			withName: hifiasm {
				container = "${params.bio}/hifiasm:0.13--h8b12597_0"
				memory = 500.GB
				cpus = 48
				time = '5d'
				queue = 'bigmem'
			}
			withName: pbipa {
				container = "${params.bio}/pbipa:1.3.2--hee625c5_0"
				memory = 500.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
			}
			withName: flye {
				container = "${params.bio}/flye:2.8.2--py36h5202f60_0"
				memory = 500.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
			}
			withName: nextdonovo {
				container = "${params.FOG}:nextdenovo-2.4.0"
				memory = 500.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
			}
			withName: pb_assembly {
				container = "${params.bio}/pb-assembly:0.0.8--0"
				memory = 500.GB
                cpus = 48
                time = '5d'
                queue = 'bigmem'
			}
			withName: mummer {
				container = "${params.bio}/mummer4:4.0.0rc1--pl526he1b5a44_0"
			}
			withName: transposonpsi {
				container = "${params.bio}/transposonpsi:1.0.0--1"
			}
			withName: tetools {
				container = "${params.FOG}:dfamtetools-1.2"
			}
			withName: minimap2 {
				container = "${params.bio}/minimap2:2.17--hed695b0_3"
			}
			withName: merqury {
				container = "${params.bio}/merqury:1.1--0"
			}
			withName: purge_haplotigs {
				container = "${params.bio}/purge_haplotigs:1.1.1--0"
			}
/*
			//polishing
			racon
			nextpolish

			//phasing + varcalling
			only use pipeline DipAsm
			1) Peregrine (un-phased contigs)
			2) HiRise (un-phased scaffolds) //phasing
			falcon-phase
			Allhic
			MarginPhase

			3) DeepV (Map HiFi reads to scaffolds and call SNPs)
			HaploTypo
			4) WhatsHap + HapCUT2 (Phase SNPs)
			5) WhatsHap (Partition reads based on their phase)
			6) Peregrine (Assemble partitioned reads into phased contigs)

			//polishing after phasing
			purge_haplotigs

			//evaluation
			auN / GAGE
			genomeqc, assembly stats

			//chromosome visualizer
			chromomap app

			//strand-seq
			**https://github.com/daewoooo/StrandPhaseR

			ISOSEQ
			//mapping isoseq3
			pilon

			//isoseq
			withName: isoseq3 {
				container = "${params.biocontainers}/isoseq3:3.4.0--0"
			}
			withName: salsa2 {
				container = 'shub://kiwiepic/FOG:salsa-2.2'
			}

			//alternative transcription initiation
			//alternative splicing
			//alternative cleavage and polyadenylation
			//natural antisence transcripts
			//circular RNA
			prapi

			//Transcriptome Annotation by Modular Algorithms
			TAMA
*/
		}
        singularity.enabled = true
		singularity.cacheDir = "${params.wdir}/work/singularity"
    }
}